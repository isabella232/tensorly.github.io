


<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="keywords" content="tensor learning, tensor decomposition, tensor operations">
        <meta name="description" content="TensorLy: Tensor learning in Python">

        
        <meta name="author" content="Jean Kossaifi">
        <title>TensorLy: Tensor learning in Python</title>
        

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="../_static/bulma.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/base.min.css" />
        <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

        
        

        
        
    </head>

    <body>
        
        <nav class="navbar is-dark has-shadow top" id="top">
    <div class="navbar-brand">
        <a class="navbar-item navbar-title" href="../home.html">
            TensorLy
        </a>

        <a class="navbar-item is-tab is-hidden-desktop" href="../index.html">
            <i class="fa fa-home" aria-hidden="true"></i>
        </a>

        <a class="navbar-item is-tab is-hidden-desktop" href="https://github.com/tensorly/tensorly" target="_blank">
            <span class="icon"><i class="fa fa-github"></i></span>
        </a>

		<span class="navbar-burger" data-target="NavbarMenu" >
			<span></span>
			<span></span>
			<span></span>
		</span>

    </div>

	<div id="NavbarMenu" class="navbar-menu">
		<div class="navbar-start">

			<a class="navbar-item" href="../installation.html">
				Install
			</a>
			<a class="navbar-item" href="../user_guide/index.html">
				User guide
			</a>
			<a class="navbar-item" href="../modules/api.html">
				API
			</a>
			<a class="navbar-item" href="../auto_examples/index.html">
				Examples
			</a>
			<a class="navbar-item" href="../authors.html">
				People
			</a>
			<a class="navbar-item" href="https://github.com/JeanKossaifi/tensorly-notebooks" target="_blank">
				Notebooks
			</a>

		</div>

		<div class="navbar-end">
			<a class="navbar-item is-tab tooltip is-hidden-touch" href="../index.html">
				<i class="fa fa-home" aria-hidden="true"></i>
				<span class="tooltiptext">Home page</span>
			</a>

			<a class="navbar-item is-tab tooltip is-hidden-touch" href="https://github.com/tensorly/tensorly" target="_blank">
				<span class="tooltiptext">Open project on Github</span>
				<span class="icon"><i class="fa fa-github"></i></span>
			</a>

		</div>
    </div>
</nav>
 

        
        <div class="columns">
            
            <div class="column is-one-quarter is-hidden-mobile aside">
                <div class="sidebar" id="sidebar">
                    
                    <div class="search">
                        <div class="search-title">
                            Search in TensorLy
                        </div>

                        <script>
                          (function() {
                            var cx = '002285679029256671182:5tfqz3cvmm8';
                            var gcse = document.createElement('script');
                            gcse.type = 'text/javascript';
                            gcse.async = true;
                            gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                            var s = document.getElementsByTagName('script')[0];
                            s.parentNode.insertBefore(gcse, s);
                          })();
                        </script>
                        <gcse:searchbox-only></gcse:searchbox-only>
                        
                    </div>

                    <div class="toc">
                    
                    
                    
                    
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing tensorly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Gallery of examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Backend System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-the-backend-system-works">How the Backend System Works</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JeanKossaifi/tensorly-notebooks">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">People</a></li>
</ul>

                    
                    
                    </div>
                    
                </div>
            </div>

            
            <div class="column is-three-quarters main-column">
                <div class="content main-content">

                    

  <div class="section" id="backend-system">
<span id="id1"></span><h1>Backend System</h1>
<p>The TensorLy backend system allows for switching between multiple backends in
a thread-local way.  You can obtain the back that is currently being used with the
<code class="docutils literal notranslate"><span class="pre">get_backend()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tensorly</span> <span class="k">as</span> <span class="nn">tl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="go">&#39;numpy&#39;</span>
</pre></div>
</div>
<p>You may set the backend globally with the <code class="docutils literal notranslate"><span class="pre">set_backend()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="go">&#39;tensorflow&#39;</span>
</pre></div>
</div>
<p>Setting the backend is local to the thread that <code class="docutils literal notranslate"><span class="pre">set_backend()</span></code> is
executed on. This enables third-party packages (e.g. Dask) to parallelize
operations over multiple backends, as needed. Threads inherit the backend
from the thread that spawned them (which is typically the main thread).
Globally setting the backend supports interactive usage.</p>
<p>Additionally,  we provide a context manager <code class="docutils literal notranslate"><span class="pre">backend_context</span></code>
for convenience, whcih may be used to
safely use a backend only for limited context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">tl</span><span class="o">.</span><span class="n">backend_context</span><span class="p">(</span><span class="s1">&#39;pytorch&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>This is also thread-safe. The context manager approach is useful in
third-party libraries that wish to ensure a particular backend is used,
no matter what the global backend is set to at the time the library code
is executed.</p>
<div class="section" id="how-the-backend-system-works">
<h2>How the Backend System Works</h2>
<div class="section" id="the-backend-class">
<h3>The Backend class</h3>
<p>A backend is represented as a class, which implements the various functions needed
(e.g. <cite>transpose</cite>, <cite>clip</cite>, etc).</p>
<p>A base class <code class="docutils literal notranslate"><span class="pre">tensorly.backend.core.Backend</span></code> is given in <cite>tensorly/backend/core.py</cite>,
which implement <code class="docutils literal notranslate"><span class="pre">staticmethods</span></code> of the common TensorLy API
(e.g. <code class="docutils literal notranslate"><span class="pre">tensor</span></code>, <code class="docutils literal notranslate"><span class="pre">fold</span></code>, <code class="docutils literal notranslate"><span class="pre">norm</span></code>, etc.).
It will also provide some useful functions by default (e.g. <cite>kron</cite>, <cite>kr</cite>, <cite>partial_svd</cite>).</p>
<p>This base class should be subclassed when defining a new backend.</p>
</div>
<div class="section" id="loading-a-backend">
<h3>Loading a backend</h3>
<p>The logic for loading is in <cite>tensorly/backend/__init__.py</cite>.
A cache of already loaded backend is maintained
as in a dictionary <code class="docutils literal notranslate"><span class="pre">_LOADED_BACKENDS</span></code>
(the keys of which are the backendsâ€™ names and the values the actual backend classes).</p>
<p>When a backend is set (by calling <code class="docutils literal notranslate"><span class="pre">tensorly.backend.set_backend</span></code>),
the backend specific module (called``tensorly.backend.{name}_backend``)
is loaded if the backend has not already been loaded and set as the current backend.</p>
<p>If the backend name is not in <code class="docutils literal notranslate"><span class="pre">_LOADED_BACKENDS</span></code>,
the corresponding backend module
(<code class="docutils literal notranslate"><span class="pre">tensorly.backend.{name}_backend</span></code>)
is dynamically imported
(via <code class="docutils literal notranslate"><span class="pre">importlib</span></code>) by the the <code class="docutils literal notranslate"><span class="pre">tensorly.backend.register_backend</span></code> function.</p>
<p>Once the backend is loaded, it is
grabbed from the internal cache (<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._LOADED_BACKENDS</span></code>)
and set as the current backend (<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._STATE.backend</span></code>).
Note that <code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._STATE.backend</span></code> is a thread-local storage.</p>
</div>
<div class="section" id="backend-function-s-dispatching">
<h3>Backend functionâ€™s dispatching</h3>
<p>The TensorLy API functions are then dynamically farmed out to the backend
staticmethods via the dispatching mechanism provided by
<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core.dispatch</span></code>. This ensure that the API function is
wrapped such that it has the correct docstring, name, function signature, and
other required minutia.</p>
<p>Additionally, the modules themselves are also wrapped such that certain
global (module-level) variables ar dynamically dispatched as well, like
<code class="docutils literal notranslate"><span class="pre">property</span></code> or other class descriptors. This is to ensure that variables
such as <code class="docutils literal notranslate"><span class="pre">int32</span></code> or <code class="docutils literal notranslate"><span class="pre">float64</span></code> point to the correct, backend-specific
object.  For example, numpyâ€™s <code class="docutils literal notranslate"><span class="pre">np.int32</span></code> and tensorflowâ€™s <code class="docutils literal notranslate"><span class="pre">tf.int32</span></code>
are not compatible.</p>
<p>The dynamic dispatch of these module-level varaibles
is implemented by the <code class="docutils literal notranslate"><span class="pre">tensorly.backend.override_module_dispatch</span></code>
function.
This is done in two ways:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>For Python &gt;= 3.7.0</strong>: using moduleâ€™s _getattr__ and __dir__ as defined by</dt><dd><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0562/">PEP 562</a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>For Python &lt; 3.7.0</strong>: by overwriting</dt><dd><p>sys.modules[module_name].__class__ with a custom class,
subclassing <code class="docutils literal notranslate"><span class="pre">types.ModuleType</span></code> for which we have overrridden the
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> and <code class="docutils literal notranslate"><span class="pre">__dir__</span></code> methods.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>




                    <nav class="pagination">
    
    
    <a class="button is-medium pagination-previous" href="documentation.html" title="Documentation" accesskey="p">
        <span class="icon">
            <i class="fa fa-arrow-circle-left"></i>
        </span>
        <span>Previous</span>
    </a>
    
    
    <a class="button is-medium pagination-next" href="../authors.html" title="People" accesskey="n">
        <span>Next </span>
        <span class="icon">
            <i class="fa fa-arrow-circle-right"></i>
        </span>
    </a>
    
</nav>

                </div>

                <footer class="footer">
    <div class="container has-text-centered">

        <p>
                &copy; 2016 - 2020, Jean Kossaifi.
        </p> 
    </div>
</footer>
            </div>

        </div>

        
        

        <script src="../_static/navigation.min.js"></script>
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-86209849-1', 'auto');
    ga('send', 'pageview');
</script>

    </body>
</html>